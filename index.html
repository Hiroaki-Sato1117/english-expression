<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Tracker 2026</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='16' fill='%2316a34a'/><text x='50' y='62' text-anchor='middle' font-size='50' font-family='sans-serif' font-weight='bold' fill='white'>‚ú¶</text></svg>">
<style>
@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap');
:root,[data-theme="light"]{
--bg:#f0f5f0;--bg2:#e8f0e8;--surface:rgba(255,255,255,.82);--surfaceSolid:#fff;
--border:rgba(0,80,20,.08);--border2:rgba(0,80,20,.12);
--text:#1a2e1a;--text2:#3d5a3d;--text3:#6b8a6b;--text4:#9ab09a;
--accent:#16a34a;--accent2:#15803d;--accentLight:rgba(22,163,74,.1);--accentLight2:rgba(22,163,74,.06);
--green50:#f0fdf4;--green800:#166534;--green900:#14532d;
--green300:#86efac;--green400:#4ade80;--green500:#22c55e;
--red:#ef4444;--navBg:rgba(22,101,52,.95);
--shadow:0 2px 12px rgba(0,40,10,.06),0 1px 3px rgba(0,0,0,.04);
--shadow2:0 8px 32px rgba(0,40,10,.08),0 2px 8px rgba(0,0,0,.03);
--naBg:rgba(0,0,0,.03);--naLine:rgba(0,0,0,.08);
--heatL1:#dcfce7;--heatL2:#bbf7d0;--heatL3:#86efac;--heatL4:#22c55e;--heatBg:#e8f0e8;
--barTrack:var(--bg2);--barFill:linear-gradient(90deg,var(--green400),var(--green500));
--chartLine:#15803d;--chartGrid:rgba(22,163,74,.1);
--mD:#f59e0b;--mS:#22c55e;--mH:#60a5fa;--mZ:#ef4444;
--mDb:rgba(245,158,11,.15);--mSb:rgba(34,197,94,.15);--mHb:rgba(96,165,250,.15);--mZb:rgba(239,68,68,.1);
--colNum:36px;--colTask:200px;--colDay:36px;
}
[data-theme="dark"]{
--bg:#0c1a0c;--bg2:#132013;--surface:rgba(20,40,20,.75);--surfaceSolid:#162016;
--border:rgba(134,239,172,.08);--border2:rgba(134,239,172,.12);
--text:#e8f5e8;--text2:#b0d4b0;--text3:#7aaa7a;--text4:#4a7a4a;
--accent:#4ade80;--accent2:#86efac;--accentLight:rgba(74,222,128,.12);--accentLight2:rgba(74,222,128,.06);
--green50:#0a1f0a;--green800:#bbf7d0;--green900:#dcfce7;
--green300:#1e5a1e;--green400:#22742e;--green500:#22c55e;
--red:#f87171;--navBg:rgba(12,26,12,.95);
--shadow:0 2px 12px rgba(0,0,0,.3);--shadow2:0 8px 32px rgba(0,0,0,.4);
--naBg:rgba(255,255,255,.03);--naLine:rgba(255,255,255,.08);
--heatL1:#132813;--heatL2:#1a3a1a;--heatL3:#1e5a1e;--heatL4:#22c55e;--heatBg:#1a2a1a;
--barTrack:var(--bg2);--barFill:linear-gradient(90deg,var(--green500),var(--green400));
--chartLine:#4ade80;--chartGrid:rgba(74,222,128,.08);
--mD:#fbbf24;--mS:#4ade80;--mH:#93bbfd;--mZ:#f87171;
--mDb:rgba(251,191,36,.12);--mSb:rgba(74,222,128,.12);--mHb:rgba(147,187,253,.1);--mZb:rgba(248,113,113,.1);
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;transition:background .4s,color .4s;}
#particles{position:fixed;inset:0;pointer-events:none;z-index:9999;}
.nav{backdrop-filter:blur(20px);background:var(--navBg);padding:0 20px;display:flex;align-items:center;height:52px;position:sticky;top:0;z-index:50;border-bottom:1px solid rgba(255,255,255,.06);}
.nav-brand{font-weight:800;font-size:15px;color:white;margin-right:24px;white-space:nowrap;}
.nav-scroll{display:flex;gap:2px;height:100%;align-items:end;overflow-x:auto;flex:1;scrollbar-width:none;}
.nav-scroll::-webkit-scrollbar{display:none;}
.ntab{padding:8px 14px;font-size:12px;font-weight:600;color:rgba(255,255,255,.5);cursor:pointer;border-radius:10px 10px 0 0;transition:all .2s;border:none;background:none;font-family:inherit;white-space:nowrap;}
.ntab:hover{color:rgba(255,255,255,.85);background:rgba(255,255,255,.07);}
.ntab.active{color:var(--text);background:var(--bg);font-weight:700;}
.ntab.dt{margin-left:8px;color:rgba(255,255,255,.7);}.ntab.dt.active{color:var(--text);}
.nav-right{display:flex;align-items:center;margin-left:12px;}
.tbtn{width:36px;height:36px;border-radius:50%;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.08);color:white;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;}
.tbtn:hover{background:rgba(255,255,255,.15);transform:scale(1.1);}
.main{padding:20px;}
.mv,.dv{display:none;animation:fu .3s ease;}.mv.active,.dv.active{display:block;}
@keyframes fu{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

.fb{display:flex;gap:12px;align-items:center;margin-bottom:16px;padding:12px 16px;background:var(--surface);backdrop-filter:blur(16px);border-radius:14px;border:1px solid var(--border);box-shadow:var(--shadow);flex-wrap:wrap;}
.fb-ring{position:relative;width:50px;height:50px;flex-shrink:0;}
.fb-ring svg{width:50px;height:50px;transform:rotate(-90deg);}
.ring-bg{fill:none;stroke:var(--bg2);stroke-width:5;}
.ring-fg{fill:none;stroke:var(--accent);stroke-width:5;stroke-linecap:round;transition:stroke-dashoffset .6s;}
.fb-pct{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:700;color:var(--accent);}
.fb-info{flex:1;min-width:140px;}.fb-date{font-size:13px;font-weight:700;}.fb-sub{font-size:11px;color:var(--text3);margin-top:1px;}
.fb-streak{display:flex;align-items:center;gap:6px;padding:6px 12px;border-radius:10px;background:var(--accentLight);}
.fb-streak .fire{font-size:18px;}.fb-streak .sn{font-family:'JetBrains Mono',monospace;font-size:16px;font-weight:800;color:var(--accent);}.fb-streak .sl{font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;}
.fb-diff{display:flex;align-items:center;gap:4px;padding:6px 12px;border-radius:10px;background:var(--accentLight);font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;}
.fb-diff.up{color:var(--accent);}.fb-diff.down{color:var(--red);}.fb-diff.flat{color:var(--text4);}
.fb-diff .dl{font-size:9px;color:var(--text3);font-family:'Outfit',sans-serif;font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-left:2px;}
.fb-quote{flex:1 1 180px;padding:6px 12px;font-size:14px;font-style:italic;color:var(--text);line-height:1.4;min-width:0;border-left:3px solid var(--accent);font-weight:500;}
.fb-quote .qa{font-size:11px;font-style:normal;font-weight:600;color:var(--text3);margin-top:3px;}

.card{background:var(--surface);backdrop-filter:blur(16px);border-radius:16px;box-shadow:var(--shadow2);border:1px solid var(--border);overflow:hidden;margin-bottom:18px;}
.lgd{display:flex;gap:10px;padding:5px 16px;font-size:9px;color:var(--text4);border-bottom:1px solid var(--border);align-items:center;}
.lgd b{color:var(--text3);font-weight:600;margin-right:2px;}.lgd span{display:flex;align-items:center;gap:2px;}.lgd .lm{font-weight:800;font-size:11px;}

.st{border-collapse:collapse;width:max-content;min-width:100%;table-layout:fixed;}
.st th,.st td{border-bottom:1px solid var(--border);border-right:1px solid var(--border);text-align:center;font-size:12px;overflow:hidden;}
.st th:first-child,.st td:first-child{width:var(--colNum);min-width:var(--colNum);max-width:var(--colNum);position:sticky;left:0;z-index:2;}
.st th:nth-child(2),.st td:nth-child(2){width:var(--colTask);min-width:var(--colTask);max-width:var(--colTask);text-align:left;position:sticky;left:var(--colNum);z-index:2;border-right:2px solid var(--border2);}
.st th:first-child,.st th:nth-child(2){z-index:4;}
.st th:nth-child(n+3),.st td:nth-child(n+3){width:var(--colDay);min-width:var(--colDay);max-width:var(--colDay);}
.ss{overflow-x:auto;scrollbar-width:none;}.ss::-webkit-scrollbar{display:none;}

.hw thead th{background:var(--green800);color:white;font-weight:600;font-size:10px;padding:7px 0;white-space:nowrap;}
[data-theme="dark"] .hw thead th{background:var(--surfaceSolid);color:var(--text);}
.hw thead th:nth-child(2){padding-left:10px;}
.hw thead th.wk{background:var(--green900);}[data-theme="dark"] .hw thead th.wk{background:var(--bg2);}
.hw thead th.tc{background:var(--accent)!important;color:white!important;}
.dn{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:700;display:block;}.dname{font-size:8px;opacity:.7;}

.bw{max-height:216px;overflow-y:auto;overflow-x:auto;scrollbar-width:thin;}
.bw::-webkit-scrollbar{width:4px;height:0;}.bw::-webkit-scrollbar-thumb{background:var(--accent);border-radius:2px;}
.bw tr{transition:background .1s;}
.bw tr:hover{background:var(--accentLight2)!important;}
.bw tr:nth-child(even){background:var(--accentLight2);}
.bw tr td:first-child,.bw tr td:nth-child(2){background:var(--surfaceSolid);}
.bw tr:nth-child(even) td:first-child,.bw tr:nth-child(even) td:nth-child(2){background:color-mix(in srgb,var(--surfaceSolid) 95%,var(--accent));}
.bw tr:hover td:first-child,.bw tr:hover td:nth-child(2){background:var(--accentLight)!important;}

td.tn{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text4);font-weight:600;height:36px;padding:0;}
td.tname{padding:0 0 0 8px;font-weight:500;font-size:13px;height:36px;position:relative;}
td.tname .tw-inner{display:flex;align-items:center;height:100%;gap:2px;}
td.tname .edt{outline:none;border:none;background:transparent;font-family:'Outfit',sans-serif;font-size:13px;font-weight:500;color:var(--text);flex:1;min-width:0;padding:2px 0;border-bottom:1px dashed transparent;transition:border-color .2s;}
td.tname .edt:focus{border-bottom-color:var(--accent);}
/* History button */
td.tname .hbtn{width:18px;height:18px;border:none;background:transparent;color:var(--text4);cursor:pointer;font-size:10px;border-radius:3px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s;opacity:.5;}
td.tname .hbtn:hover{opacity:1;background:var(--accentLight);color:var(--accent);}
td.tname .del{width:22px;height:22px;border:none;background:transparent;color:var(--text4);cursor:pointer;font-size:11px;border-radius:4px;display:none;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s;}
tr:hover td.tname .del{display:flex;}
td.tname .del:hover{background:rgba(239,68,68,.12);color:var(--red);}

/* Deleted row */
tr.deleted-row{opacity:.5;}
tr.deleted-row td.tname .edt{text-decoration:line-through;color:var(--text4);}
td.tname .rbtn{font-family:'Outfit',sans-serif;font-size:9px;font-weight:600;color:var(--accent);background:var(--accentLight);border:1px solid var(--accent);border-radius:4px;cursor:pointer;padding:2px 6px;flex-shrink:0;transition:all .15s;white-space:nowrap;}
td.tname .rbtn:hover{background:var(--accent);color:white;}

/* History popup */
.hist-pop{position:absolute;top:100%;left:8px;z-index:200;background:var(--surfaceSolid);border:1px solid var(--border2);border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.15);padding:10px 12px;min-width:220px;max-width:300px;animation:fu .12s ease;}
.hist-pop-title{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;}
.hist-entry{font-size:11px;color:var(--text2);padding:3px 0;border-bottom:1px solid var(--border);display:flex;gap:6px;}
.hist-entry:last-child{border:none;}
.hist-entry .he-date{font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:600;color:var(--accent);flex-shrink:0;min-width:32px;}
.hist-entry .he-text{font-size:11px;}

.add-row td{height:32px;border-bottom:none!important;}
.abtn{font-family:'Outfit',sans-serif;font-size:11px;font-weight:600;color:var(--accent);background:none;border:none;cursor:pointer;padding:4px 8px;border-radius:6px;transition:all .15s;}
.abtn:hover{background:var(--accentLight);}

td.cc{height:36px;padding:0;cursor:pointer;transition:all .12s;position:relative;user-select:none;font-size:14px;font-weight:800;}
td.cc:hover{background:var(--accentLight)!important;}
td.cc.m-d{background:var(--mDb)!important;color:var(--mD);}
td.cc.m-s{background:var(--mSb)!important;color:var(--mS);}
td.cc.m-h{background:var(--mHb)!important;color:var(--mH);}
td.cc.m-z{background:var(--mZb)!important;color:var(--mZ);}
td.cc .mk{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;animation:pop .2s cubic-bezier(.175,.885,.32,1.275);}
@keyframes pop{0%{transform:scale(0) rotate(-10deg);opacity:0}100%{transform:scale(1);opacity:1}}
td.cc.tc{box-shadow:inset 0 0 0 2px var(--accent);border-radius:2px;}
td.cc.na{background:var(--naBg)!important;cursor:default;pointer-events:none;}
td.cc.na::after{content:'';display:block;position:absolute;left:28%;right:28%;top:50%;height:1.5px;background:var(--naLine);transform:translateY(-50%);}

.mdd{position:absolute;top:calc(100% + 2px);left:50%;transform:translateX(-50%);z-index:200;background:var(--surfaceSolid);border:1px solid var(--border2);border-radius:8px;box-shadow:0 6px 20px rgba(0,0,0,.15);padding:3px;display:flex;gap:1px;animation:fu .12s ease;}
.mdd button{width:34px;height:34px;border:none;border-radius:6px;cursor:pointer;font-size:15px;font-weight:800;background:transparent;transition:all .1s;display:flex;align-items:center;justify-content:center;}
.mdd button:hover{transform:scale(1.1);}
.mdd .dd-d{color:var(--mD);}.mdd .dd-d:hover{background:var(--mDb);}
.mdd .dd-s{color:var(--mS);}.mdd .dd-s:hover{background:var(--mSb);}
.mdd .dd-h{color:var(--mH);}.mdd .dd-h:hover{background:var(--mHb);}
.mdd .dd-z{color:var(--mZ);}.mdd .dd-z:hover{background:var(--mZb);}
.mdd .dd-c{color:var(--text4);font-size:12px;}.mdd .dd-c:hover{background:var(--accentLight);}

.sw{overflow-x:auto;border-top:2px solid var(--border2);scrollbar-width:none;}.sw::-webkit-scrollbar{display:none;}
.sr td{background:var(--green50)!important;font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:500;color:var(--accent2);height:28px;padding:0;}
.sr td:nth-child(2){font-family:'Outfit',sans-serif;font-weight:700;font-size:10px;letter-spacing:.6px;color:var(--accent);padding-left:10px;text-transform:uppercase;}

.cs{background:var(--green50);border-top:2px solid var(--border2);}
.ch{display:flex;align-items:center;justify-content:space-between;padding:10px 16px 4px;}
.ctt{font-size:12px;font-weight:700;color:var(--text2);}
.cl{display:flex;gap:10px;font-size:10px;color:var(--text3);}.cl span{display:flex;align-items:center;gap:3px;}
.ld{width:8px;height:8px;border-radius:50%;}.l1{background:var(--green300);}.l2{background:var(--chartLine);}
.chart-body{display:flex;align-items:stretch;padding:0 0 10px 0;}
.chart-side{width:calc(var(--colNum) + var(--colTask) + 2px);flex-shrink:0;padding:8px 12px;display:flex;flex-direction:column;justify-content:center;gap:6px;border-right:2px solid var(--border2);}
.cs-item{display:flex;justify-content:space-between;align-items:center;}
.cs-label{font-size:10px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:.3px;}
.cs-val{font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:800;color:var(--accent);}
.cs-val.sub{font-size:11px;color:var(--text2);}
.cc-wrap{flex:1;height:150px;padding:0 8px 0 0;min-width:0;}.cc-wrap svg{width:100%;height:100%;}

.ftr{padding:8px 16px;background:var(--green50);display:flex;gap:8px;align-items:center;flex-wrap:wrap;border-top:1px solid var(--border);}
.ftr button{font-family:'Outfit',sans-serif;font-size:11px;font-weight:600;padding:5px 11px;border-radius:7px;border:1px solid var(--border2);background:var(--surfaceSolid);color:var(--accent);cursor:pointer;transition:all .15s;}
.ftr button:hover{background:var(--accentLight);border-color:var(--accent);}
.ftr .ht{font-size:9px;color:var(--text4);margin-left:auto;}
.si{font-size:10px;color:var(--accent);margin-left:6px;opacity:0;transition:opacity .3s;}.si.show{opacity:1;}
.tp{position:fixed;background:var(--text);color:var(--bg);padding:5px 9px;border-radius:7px;font-size:11px;pointer-events:none;opacity:0;transition:opacity .12s;z-index:100;white-space:nowrap;font-family:'JetBrains Mono',monospace;box-shadow:0 4px 12px rgba(0,0,0,.2);}

.dh{display:flex;gap:14px;margin-bottom:18px;flex-wrap:wrap;}
.ds{flex:1;min-width:120px;padding:14px;background:var(--surface);backdrop-filter:blur(16px);border-radius:14px;border:1px solid var(--border);box-shadow:var(--shadow);text-align:center;}
.dsv{font-family:'JetBrains Mono',monospace;font-size:26px;font-weight:800;color:var(--accent);letter-spacing:-1px;}
.dsl{font-size:9px;color:var(--text3);margin-top:3px;text-transform:uppercase;letter-spacing:.5px;font-weight:600;}
.dg{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:18px;}
@media(max-width:900px){.dg{grid-template-columns:1fr;}}
.dc{background:var(--surface);backdrop-filter:blur(16px);border-radius:14px;box-shadow:var(--shadow);border:1px solid var(--border);padding:16px;}
.dc h3{font-size:13px;font-weight:700;color:var(--text);margin-bottom:10px;}.dc.full{grid-column:1/-1;}
.br{display:flex;align-items:center;gap:8px;margin-bottom:5px;}
.bl{font-size:11px;font-weight:600;color:var(--text3);width:34px;text-align:right;font-family:'JetBrains Mono',monospace;}
.bt{flex:1;height:22px;background:var(--barTrack);border-radius:5px;overflow:hidden;}
.bf{height:100%;background:var(--barFill);border-radius:5px;transition:width .6s;display:flex;align-items:center;justify-content:flex-end;padding-right:5px;}
.bp{font-family:'JetBrains Mono',monospace;font-size:9px;font-weight:700;color:white;}
.rr{display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid var(--border);}.rr:last-child{border:none;}
.rn{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:800;color:var(--accent);width:18px;text-align:center;}
.rname{flex:1;font-size:12px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.rm{width:70px;height:5px;background:var(--barTrack);border-radius:3px;overflow:hidden;}
.rmf{height:100%;background:var(--accent);border-radius:3px;transition:width .5s;}
.rp{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;color:var(--text2);width:36px;text-align:right;}
.hml{font-size:10px;font-weight:700;color:var(--text3);margin-top:6px;margin-bottom:2px;}
.hmr{display:flex;gap:2px;flex-wrap:wrap;}
.hd{width:11px;height:11px;border-radius:2px;background:var(--heatBg);}
.hd.l1{background:var(--heatL1);}.hd.l2{background:var(--heatL2);}.hd.l3{background:var(--heatL3);}.hd.l4{background:var(--heatL4);}
</style>
</head>
<body>
<canvas id="particles"></canvas>
<nav class="nav"><div class="nav-brand">‚ú¶ Daily Tracker</div><div class="nav-scroll" id="nv"></div><div class="nav-right"><button class="tbtn" id="tb" onclick="tTh()">üåô</button></div></nav>
<div class="main"><div class="mv" id="mV"></div><div class="dv" id="dV"></div></div>
<div class="tp" id="tp"></div>
<script>
const MS=[{y:2026,m:2},{y:2026,m:3},{y:2026,m:4},{y:2026,m:5},{y:2026,m:6},{y:2026,m:7},{y:2026,m:8},{y:2026,m:9},{y:2026,m:10},{y:2026,m:11},{y:2026,m:12}];
const DN=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],MN=['','Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
const DT=['Wake up until 8 am ‚òÄÔ∏è','Learning English üìñ','Gym or Running üèãÔ∏è','Learning for Boki üìñ','Check 1 news üì∞','Maintain posture for 5min','Stop porn üí¶','Apply sunscreen üòé','Take oligosaccharides üíä','Go to bed until 1 am üõèÔ∏è'];
const MK={double:{s:'‚óé',v:1.2,c:'m-d'},single:{s:'‚óã',v:1.0,c:'m-s'},half:{s:'‚ñ≥',v:0.5,c:'m-h'},zero:{s:'√ó',v:0,c:'m-z'}};
const QUOTES=[
["We are what we repeatedly do. Excellence is not an act, but a habit.","Aristotle"],
["Small daily improvements over time lead to stunning results.","Robin Sharma"],
["Success is the sum of small efforts, repeated day in and day out.","Robert Collier"],
["The secret of your future is hidden in your daily routine.","Mike Murdock"],
["Motivation is what gets you started. Habit is what keeps you going.","Jim Ryun"],
["You'll never change your life until you change something you do daily.","John C. Maxwell"],
["Consistency is what transforms average into excellence.",""],
["It's not what we do once in a while that shapes our lives, but what we do consistently.","Tony Robbins"],
["Dripping water hollows out stone not through force, but through persistence.","Ovid"],
["The chains of habit are too light to be felt until they are too heavy to be broken.","Warren Buffett"],
["First forget inspiration. Habit is more dependable.","Octavia Butler"],
["A habit cannot be tossed out the window; it must be coaxed down the stairs a step at a time.","Mark Twain"],
["People do not decide their futures. They decide their habits, and their habits decide their futures.","F.M. Alexander"],
["Champions don't do extraordinary things. They do ordinary things, but they do them without thinking.","Charles Duhigg"],
["You do not rise to the level of your goals. You fall to the level of your systems.","James Clear"],
["The difference between who you are and who you want to be is what you do.",""],
["Every action you take is a vote for the type of person you wish to become.","James Clear"],
["Discipline is choosing between what you want now and what you want most.","Abraham Lincoln"],
["Long-term consistency trumps short-term intensity.","Bruce Lee"],
["One percent better every day. That's all it takes.",""],
["The only way to do great work is to show up every single day.",""],
["Your future self is watching you right now through memories.",""],
["Don't count the days. Make the days count.","Muhammad Ali"],
["It does not matter how slowly you go, as long as you do not stop.","Confucius"],
["Be patient with yourself. Self-growth is tender.",""],
["What you do every day matters more than what you do once in a while.","Gretchen Rubin"],
["Habits are the compound interest of self-improvement.","James Clear"],
["The best time to plant a tree was 20 years ago. The second best time is now.",""],
["Fall seven times, stand up eight.","Japanese proverb"],
["Today is a good day to build a good habit.",""]
];
function getQuote(){const d=new Date();const idx=(d.getFullYear()*1000+d.getMonth()*31+d.getDate())%QUOTES.length;return QUOTES[idx];}
let D={},cv=null,aDD=null,aPop=null,audioCtx=null;
function gAC(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();return audioCtx;}
function pS(t){try{const c=gAC(),o=c.createOscillator(),g=c.createGain();o.connect(g);g.connect(c.destination);g.gain.value=.08;
if(t==='double'){o.frequency.value=880;g.gain.value=.1;o.type='sine';o.start();o.frequency.exponentialRampToValueAtTime(1320,c.currentTime+.08);g.gain.exponentialRampToValueAtTime(.001,c.currentTime+.15);o.stop(c.currentTime+.15);}
else if(t==='single'){o.frequency.value=660;o.type='sine';o.start();g.gain.exponentialRampToValueAtTime(.001,c.currentTime+.1);o.stop(c.currentTime+.1);}
else if(t==='half'){o.frequency.value=440;o.type='triangle';o.start();g.gain.exponentialRampToValueAtTime(.001,c.currentTime+.1);o.stop(c.currentTime+.1);}
else if(t==='zero'){o.frequency.value=220;o.type='sawtooth';g.gain.value=.05;o.start();o.frequency.exponentialRampToValueAtTime(150,c.currentTime+.12);g.gain.exponentialRampToValueAtTime(.001,c.currentTime+.15);o.stop(c.currentTime+.15);}
else{o.frequency.value=300;o.type='sine';g.gain.value=.04;o.start();g.gain.exponentialRampToValueAtTime(.001,c.currentTime+.06);o.stop(c.currentTime+.06);}
}catch(e){}}
function K(y,m){return`${y}-${String(m).padStart(2,'0')}`;}
function dim(y,m){return new Date(y,m,0).getDate();}
function esc(s){return s.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function save(){try{localStorage.setItem('dt8',JSON.stringify(D));}catch(e){}shSv();}
function load(){try{const s=localStorage.getItem('dt8');if(s)D=JSON.parse(s);}catch(e){}}
function shSv(){const e=document.getElementById('si');if(!e)return;e.classList.add('show');clearTimeout(e._t);e._t=setTimeout(()=>e.classList.remove('show'),1200);}

// Task active check: supports periods array [{from, to}]
// periods: [{from:1, to:null}] = active from day 1
// After delete on day 10: [{from:1, to:9}]
// After restore on day 14: [{from:1, to:9}, {from:14, to:null}]
function isA(t,d){
  if(!t.periods) return d>=t.addedDay&&(t.removedDay===null||d<=t.removedDay);
  return t.periods.some(p=>d>=p.from&&(p.to===null||d<=p.to));
}
function isDeleted(t){
  if(!t.periods) return t.removedDay!==null;
  const last=t.periods[t.periods.length-1];
  return last.to!==null;
}
function migrateToPeriods(t){
  if(t.periods) return;
  if(t.removedDay!==null){
    t.periods=[{from:t.addedDay,to:t.removedDay}];
  } else {
    t.periods=[{from:t.addedDay,to:null}];
  }
}

function iM(k){if(D[k])return;const mi=MS.findIndex(x=>K(x.y,x.m)===k);let p=null;if(mi>0){const pk=K(MS[mi-1].y,MS[mi-1].m);if(D[pk])p=D[pk].tasks.filter(t=>!isDeleted(t)).map(t=>({name:t.name,periods:[{from:1,to:null}],history:t.history?[...t.history]:[]}));}if(!p)p=DT.map(n=>({name:n,periods:[{from:1,to:null}],history:[]}));D[k]={tasks:p,marks:{}};save();}
function gMk(k,ti,d){const md=D[k];if(!md?.marks?.[ti])return null;return md.marks[ti][d]||null;}
function sMk(k,ti,d,t){const md=D[k];if(!md.marks)md.marks={};if(!md.marks[ti])md.marks[ti]={};if(t===null)delete md.marks[ti][d];else md.marks[ti][d]=t;save();}
function mV(t){return t?MK[t].v:0;}

function gS(k){const md=D[k];if(!md)return{dr:[],cr:[],ts:0,tp:0};const[y,m]=k.split('-').map(Number);const days=dim(y,m);let ts=0,tp=0;const dr=[],cr=[];
for(let d=1;d<=days;d++){const act=md.tasks.filter(t=>isA(t,d));const cnt=act.length;let sc=0;act.forEach(t=>{sc+=mV(gMk(k,md.tasks.indexOf(t),d));});ts+=sc;tp+=cnt;dr.push(cnt>0?Math.min(sc/cnt,1):0);cr.push(tp>0?Math.min(ts/tp,1):0);}return{dr,cr,ts,tp};}
function gStr(k){const md=D[k];if(!md)return 0;const[y,m]=k.split('-').map(Number);const now=new Date();let td=dim(y,m);if(now.getFullYear()===y&&now.getMonth()+1===m)td=now.getDate();let s=0;
for(let d=td;d>=1;d--){const act=md.tasks.filter(t=>isA(t,d));if(!act.length)break;if(act.every(t=>gMk(k,md.tasks.indexOf(t),d)!==null))s++;else break;}return s;}
function gTod(k){const[y,m]=k.split('-').map(Number);const now=new Date();if(now.getFullYear()!==y||now.getMonth()+1!==m)return null;const d=now.getDate();const md=D[k];if(!md)return null;const act=md.tasks.filter(t=>isA(t,d));let sc=0,mk=0;act.forEach(t=>{const ti=md.tasks.indexOf(t);const m2=gMk(k,ti,d);if(m2!==null){mk++;sc+=mV(m2);}});return{day:d,marked:mk,total:act.length,pct:act.length>0?Math.round(Math.min(sc/act.length,1)*100):0,rem:act.length-mk};}
function weekDiff(k){const md=D[k];if(!md)return null;const[y,m]=k.split('-').map(Number);const now=new Date();if(now.getFullYear()!==y||now.getMonth()+1!==m)return null;const td=now.getDate();if(td<8)return null;let tw=0,twp=0,lw=0,lwp=0;
for(let d=td;d>td-7&&d>=1;d--){const act=md.tasks.filter(t=>isA(t,d));twp+=act.length;act.forEach(t=>{tw+=mV(gMk(k,md.tasks.indexOf(t),d));});}
for(let d=td-7;d>td-14&&d>=1;d--){const act=md.tasks.filter(t=>isA(t,d));lwp+=act.length;act.forEach(t=>{lw+=mV(gMk(k,md.tasks.indexOf(t),d));});}
if(!lwp||!twp)return null;return Math.round((tw/twp-lw/lwp)*100);}

function rNav(){const n=document.getElementById('nv');n.innerHTML='';MS.forEach(({y,m})=>{const k=K(y,m);const b=document.createElement('button');b.className='ntab'+(cv===k?' active':'');b.textContent=MN[m];b.onclick=()=>sw(k);n.appendChild(b);});const db=document.createElement('button');db.className='ntab dt'+(cv==='dashboard'?' active':'');db.textContent='üìä Dashboard';db.onclick=()=>sw('dashboard');n.appendChild(db);}
function sw(v){cv=v;rNav();cDD();cPop();if(v==='dashboard'){document.getElementById('mV').className='mv';document.getElementById('dV').className='dv active';rDash();}else{document.getElementById('dV').className='dv';document.getElementById('mV').className='mv active';iM(v);rMo(v);}}

function sortedTasks(md){
  const active=[],deleted=[];
  md.tasks.forEach((t,i)=>{migrateToPeriods(t);(isDeleted(t)?deleted:active).push({t,i});});
  return[...active,...deleted];
}

function rMo(k,scrollState){
const md=D[k],[y,m]=k.split('-').map(Number),days=dim(y,m),stats=gS(k),str=gStr(k),tod=gTod(k);
const now=new Date(),isCur=now.getFullYear()===y&&now.getMonth()+1===m,td=isCur?now.getDate():-1;
const wd=weekDiff(k);
const sorted=sortedTasks(md);
let h='';
if(tod){const circ=2*Math.PI*20,off=circ-(circ*tod.pct/100);
h+=`<div class="fb"><div class="fb-ring"><svg viewBox="0 0 50 50"><circle cx="25" cy="25" r="20" class="ring-bg"/><circle cx="25" cy="25" r="20" class="ring-fg" stroke-dasharray="${circ}" stroke-dashoffset="${off}"/></svg><div class="fb-pct">${tod.pct}%</div></div><div class="fb-info"><div class="fb-date">${MN[m]} ${tod.day}, ${y} ‚Äî Today</div><div class="fb-sub">${tod.marked}/${tod.total} marked ¬∑ ${tod.rem} remaining</div></div>`;
const q=getQuote();h+=`<div class="fb-quote">"${esc(q[0])}"${q[1]?`<div class="qa">‚Äî ${esc(q[1])}</div>`:''}</div>`;
if(wd!==null){const cls=wd>0?'up':wd<0?'down':'flat';const sym=wd>0?'‚Üë':wd<0?'‚Üì':'‚Üí';h+=`<div class="fb-diff ${cls}">${sym}${wd>0?'+':''}${wd}%<span class="dl">vs last wk</span></div>`;}
h+=`<div class="fb-streak"><span class="fire">üî•</span><div><div class="sn">${str}</div><div class="sl">streak</div></div></div></div>`;}

h+=`<div class="card">`;
h+=`<div class="lgd"><b>Marks</b><span><span class="lm" style="color:var(--mD)">‚óé</span>1.2</span><span><span class="lm" style="color:var(--mS)">‚óã</span>1.0</span><span><span class="lm" style="color:var(--mH)">‚ñ≥</span>0.5</span><span><span class="lm" style="color:var(--mZ)">√ó</span>0</span></div>`;

h+=`<div class="hw ss" id="h_${k}"><table class="st"><thead><tr><th>#</th><th>Task</th>`;
for(let d=1;d<=days;d++){const dt=new Date(y,m-1,d),wk=dt.getDay()===0||dt.getDay()===6,isT=d===td;h+=`<th class="${wk?'wk':''} ${isT?'tc':''}"><span class="dn">${d}</span><span class="dname">${DN[dt.getDay()]}</span></th>`;}
h+=`</tr></thead></table></div>`;

h+=`<div class="bw ss" id="b_${k}"><table class="st"><tbody>`;
let rowNum=1;
sorted.forEach(({t:task,i:idx})=>{
const del=isDeleted(task);
const hasHist=task.history&&task.history.length>0;
h+=`<tr class="${del?'deleted-row':''}"><td class="tn">${rowNum++}</td><td class="tname"><div class="tw-inner">`;
if(del){
  h+=`<input class="edt" value="${esc(task.name)}" disabled spellcheck="false">`;
  h+=`<button class="rbtn" onclick="restoreT('${k}',${idx})">Restore</button>`;
} else {
  h+=`<input class="edt" value="${esc(task.name)}" onchange="eT('${k}',${idx},this.value)" spellcheck="false">`;
  if(hasHist)h+=`<button class="hbtn" onclick="shHist(event,'${k}',${idx})" title="History">üïê</button>`;
  h+=`<button class="del" onclick="rT('${k}',${idx})">‚úï</button>`;
}
h+=`</div></td>`;
for(let d=1;d<=days;d++){const act=isA(task,d),mk=gMk(k,idx,d),isT=d===td;
if(!act)h+=`<td class="cc na"></td>`;
else if(del)h+=`<td class="cc na"></td>`;
else{let cls='cc',co='';if(mk){cls+=` ${MK[mk].c}`;co=`<span class="mk">${MK[mk].s}</span>`;}if(isT)cls+=' tc';
h+=`<td class="${cls}" data-k="${k}" data-ti="${idx}" data-d="${d}">${co}</td>`;}}
h+=`</tr>`;});

h+=`<tr class="add-row"><td class="tn"></td><td class="tname" style="border-bottom:none!important;padding-left:8px"><button class="abtn" onclick="aT('${k}')">+ Add Task</button></td>`;
for(let d=1;d<=days;d++)h+=`<td style="border-bottom:none!important;border-right:1px solid var(--border)"></td>`;
h+=`</tr></tbody></table></div>`;

h+=`<div class="sw ss" id="s_${k}"><table class="st"><tbody>`;
h+=`<tr class="sr"><td></td><td>Score</td>`;
for(let d=1;d<=days;d++){const act=md.tasks.filter(t=>isA(t,d));let sc=0;act.forEach(t=>{sc+=mV(gMk(k,md.tasks.indexOf(t),d));});h+=`<td>${sc>0?sc.toFixed(1).replace(/\.0$/,''):'‚Äì'}</td>`;}
h+=`</tr><tr class="sr"><td></td><td>Rate</td>`;
for(let d=1;d<=days;d++){const r=stats.dr[d-1];h+=`<td>${r>0?Math.round(r*100)+'%':'‚Äì'}</td>`;}
h+=`</tr></tbody></table></div>`;

const overallRate=stats.tp>0?Math.round(Math.min(stats.ts/stats.tp,1)*100):0;
const totalScore=stats.ts.toFixed(1).replace(/\.0$/,'');
const daysWithData=stats.dr.filter(r=>r>0).length;
const bestDay=stats.dr.reduce((best,r,i)=>r>best.r?{r,i}:best,{r:0,i:0});
const bestDayNum=bestDay.r>0?bestDay.i+1:'‚Äì';
const bestDayPct=bestDay.r>0?Math.round(bestDay.r*100)+'%':'‚Äì';
h+=`<div class="cs"><div class="ch"><div class="ctt">Completion Rate</div><div class="cl"><span><span class="ld l1"></span>Daily</span><span><span class="ld l2"></span>Cumul</span></div></div><div class="chart-body"><div class="chart-side"><div class="cs-item"><span class="cs-label">Rate</span><span class="cs-val">${overallRate}%</span></div><div class="cs-item"><span class="cs-label">Score</span><span class="cs-val sub">${totalScore}</span></div><div class="cs-item"><span class="cs-label">Active</span><span class="cs-val sub">${daysWithData}d</span></div><div class="cs-item"><span class="cs-label">Best</span><span class="cs-val sub">${bestDayPct}</span></div></div><div class="cc-wrap" id="c_${k}"></div></div></div>`;
h+=`<div class="ftr"><button onclick="exC('${k}')">Export CSV</button><span class="si" id="si">‚úì Saved</span><span class="ht">Click=‚óã ¬∑ Dbl=‚óé ¬∑ Hold=menu</span></div></div>`;

document.getElementById('mV').innerHTML=h;
const els=[document.getElementById('h_'+k),document.getElementById('b_'+k),document.getElementById('s_'+k)];
let sy=false;els.forEach(el=>{if(!el)return;el.addEventListener('scroll',()=>{if(sy)return;sy=true;els.forEach(o=>{if(o&&o!==el)o.scrollLeft=el.scrollLeft;});sy=false;});});
const bEl=document.getElementById('b_'+k);if(bEl)setupCE(bEl,k);
if(scrollState){const bw2=document.getElementById('b_'+k);const hw2=document.getElementById('h_'+k);const sw2=document.getElementById('s_'+k);if(bw2){bw2.scrollTop=scrollState.by;bw2.scrollLeft=scrollState.bx;}if(hw2)hw2.scrollLeft=scrollState.hx||scrollState.bx;if(sw2)sw2.scrollLeft=scrollState.hx||scrollState.bx;}
requestAnimationFrame(()=>drCh(k,stats));
}

// Cell events
let ckT=null,isDbl=false,lpT=null,lpF=false;
function setupCE(c,k){
c.addEventListener('mousedown',function(e){const el=e.target.closest('td.cc');if(!el||el.classList.contains('na')||e.button!==0)return;lpF=false;lpT=setTimeout(()=>{lpF=true;shDD(el);},450);});
c.addEventListener('mouseup',function(){clearTimeout(lpT);});
c.addEventListener('click',function(e){if(lpF)return;const el=e.target.closest('td.cc');if(!el||el.classList.contains('na'))return;
if(ckT){clearTimeout(ckT);ckT=null;return;}
ckT=setTimeout(()=>{ckT=null;if(isDbl){isDbl=false;return;}
const{k:kk,ti,d}=cDt(el),cur=gMk(kk,ti,d);
if(cur==='single'){sMk(kk,ti,d,null);pS('clear');}else{sMk(kk,ti,d,'single');pS('single');spP(el);}
scR(kk);},300);});
c.addEventListener('dblclick',function(e){e.preventDefault();clearTimeout(lpT);clearTimeout(ckT);ckT=null;isDbl=true;
const el=e.target.closest('td.cc');if(!el||el.classList.contains('na'))return;
const{k:kk,ti,d}=cDt(el),cur=gMk(kk,ti,d);
if(cur==='double'){sMk(kk,ti,d,null);pS('clear');}else{sMk(kk,ti,d,'double');pS('double');spP(el);}
scR(kk);setTimeout(()=>{isDbl=false;},300);});
let tS=0,tE=null,tL=null,tF=false;
c.addEventListener('touchstart',function(e){const el=e.target.closest('td.cc');if(!el||el.classList.contains('na'))return;tS=Date.now();tE=el;tF=false;tL=setTimeout(()=>{tF=true;shDD(el);},450);},{passive:true});
c.addEventListener('touchend',function(e){clearTimeout(tL);if(tF||!tE)return;const el=tE;tE=null;if(Date.now()-tS<400){e.preventDefault();const{k:kk,ti,d}=cDt(el),cur=gMk(kk,ti,d);if(cur==='single'){sMk(kk,ti,d,null);pS('clear');}else{sMk(kk,ti,d,'single');pS('single');spP(el);}scR(kk);}});
}
function cDt(el){return{k:el.dataset.k,ti:+el.dataset.ti,d:+el.dataset.d};}
function shDD(el){cDD();cPop();const{k,ti,d}=cDt(el);const dd=document.createElement('div');dd.className='mdd';
[{t:'double',s:'‚óé',c:'dd-d'},{t:'single',s:'‚óã',c:'dd-s'},{t:'half',s:'‚ñ≥',c:'dd-h'},{t:'zero',s:'√ó',c:'dd-z'},{t:null,s:'‚Äì',c:'dd-c'}].forEach(o=>{
const b=document.createElement('button');b.className=o.c;b.textContent=o.s;
b.onmousedown=e=>{e.stopPropagation();e.preventDefault();};
b.onclick=e=>{e.stopPropagation();sMk(k,ti,d,o.t);if(o.t)pS(o.t);else pS('clear');if(o.t)spP(el);cDD();scR(k);};
dd.appendChild(b);});
el.style.overflow='visible';el.appendChild(dd);aDD={dd,el};
setTimeout(()=>{document.addEventListener('mousedown',oCloseDD);document.addEventListener('touchstart',oCloseDD,{passive:true});},50);}
function oCloseDD(e){if(aDD&&!aDD.dd.contains(e.target)){cDD();}}
function cDD(){if(aDD){aDD.dd.remove();aDD.el.style.overflow='';aDD=null;}document.removeEventListener('mousedown',oCloseDD);document.removeEventListener('touchstart',oCloseDD);}

// History popup
function shHist(e,k,ti){
  e.stopPropagation();cPop();cDD();
  const task=D[k].tasks[ti];if(!task.history||!task.history.length)return;
  const pop=document.createElement('div');pop.className='hist-pop';
  pop.innerHTML=`<div class="hist-pop-title">üïê Change History</div>`+
    task.history.map(h=>`<div class="hist-entry"><span class="he-date">${h.month||''}/${h.day}</span><span class="he-text">"${esc(h.oldName)}" ‚Üí "${esc(h.newName||task.name)}"</span></div>`).join('');
  const td=e.target.closest('td.tname');
  td.style.overflow='visible';td.appendChild(pop);aPop={pop,el:td};
  setTimeout(()=>{document.addEventListener('mousedown',oClosePop);document.addEventListener('touchstart',oClosePop,{passive:true});},50);
}
function oClosePop(e){if(aPop&&!aPop.pop.contains(e.target)&&!e.target.classList.contains('hbtn')){cPop();}}
function cPop(){if(aPop){aPop.pop.remove();aPop.el.style.overflow='';aPop=null;}document.removeEventListener('mousedown',oClosePop);document.removeEventListener('touchstart',oClosePop);}

let rTm=null;function scR(k){clearTimeout(rTm);rTm=setTimeout(()=>{
const bw=document.getElementById('b_'+k);const hw=document.getElementById('h_'+k);
const scrollState={bx:bw?.scrollLeft||0,by:bw?.scrollTop||0,hx:hw?.scrollLeft||0};
rMo(k,scrollState);},80);}

function eT(k,ti,v){
  const task=D[k].tasks[ti];
  const oldName=task.name;
  if(oldName===v)return;
  if(!task.history)task.history=[];
  const[y,m]=k.split('-').map(Number);const now=new Date();
  let day=1;if(now.getFullYear()===y&&now.getMonth()+1===m)day=now.getDate();
  task.history.push({day,month:m,oldName,newName:v});
  task.name=v;save();scR(k);
}

function aT(k){const[y,m]=k.split('-').map(Number);const now=new Date();let ad=1;if(now.getFullYear()===y&&now.getMonth()+1===m)ad=now.getDate();D[k].tasks.push({name:'New Task',periods:[{from:ad,to:null}],history:[]});save();rMo(k);const bw=document.getElementById('b_'+k);if(bw)bw.scrollTop=bw.scrollHeight;setTimeout(()=>{const ii=document.querySelectorAll('.edt:not([disabled])');if(ii.length){const l=ii[ii.length-1];l.focus();l.select();}},120);}

function rT(k,ti){
  const md=D[k],[y,m]=k.split('-').map(Number);const now=new Date();
  let rd=(now.getFullYear()===y&&now.getMonth()+1===m)?now.getDate():dim(y,m);
  const task=md.tasks[ti];migrateToPeriods(task);
  const last=task.periods[task.periods.length-1];
  if(last.to===null){
    if(last.from===rd){
      // Added today, just close it
      last.to=rd;
    } else {
      last.to=rd-1;
    }
  }
  save();rMo(k);
}

function restoreT(k,ti){
  const md=D[k],[y,m]=k.split('-').map(Number);const now=new Date();
  let rd=(now.getFullYear()===y&&now.getMonth()+1===m)?now.getDate():1;
  const task=md.tasks[ti];migrateToPeriods(task);
  task.periods.push({from:rd,to:null});
  save();rMo(k);
}

function drCh(k,stats){const el=document.getElementById('c_'+k);if(!el)return;const W=el.clientWidth,H=el.clientHeight;if(!W)return;
const p={t:8,r:8,b:22,l:4},cw=W-p.l-p.r,ch=H-p.t-p.b,days=stats.dr.length;if(!days)return;
const gx=d=>p.l+(cw*d/(days-1||1)),gy=v=>p.t+ch-(ch*v);
let svg=`<svg viewBox="0 0 ${W} ${H}"><defs><linearGradient id="ag" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="var(--chartLine)" stop-opacity=".25"/><stop offset="100%" stop-color="var(--chartLine)" stop-opacity=".02"/></linearGradient></defs>`;
for(let i=0;i<=4;i++){const yy=gy(i/4);svg+=`<line x1="${p.l}" y1="${yy}" x2="${W-p.r}" y2="${yy}" stroke="var(--chartGrid)" stroke-width=".5" stroke-dasharray="3,3"/>`;if(i===0||i===4)svg+=`<text x="${p.l}" y="${yy-3}" text-anchor="start" fill="var(--text4)" font-family="JetBrains Mono" font-size="7">${i*25}%</text>`;}
for(let d=0;d<days;d++){const everyN=days>20?3:days>14?2:1;if(d%everyN===0||d===days-1)svg+=`<text x="${gx(d)}" y="${H-3}" text-anchor="middle" fill="var(--text4)" font-family="JetBrains Mono" font-size="7">${d+1}</text>`;}
function sm(r){let s=`M ${gx(0)} ${gy(r[0])}`;for(let d=1;d<r.length;d++){const x=gx(d),y=gy(r[d]),px=gx(d-1),py=gy(r[d-1]);s+=` C ${px+(x-px)*.4} ${py} ${px+(x-px)*.6} ${y} ${x} ${y}`;}return s;}
const dp=sm(stats.dr);svg+=`<path d="${dp} L ${gx(days-1)} ${gy(0)} L ${gx(0)} ${gy(0)} Z" fill="url(#ag)" opacity=".7"/>`;
svg+=`<path d="${dp}" fill="none" stroke="var(--chartLine)" stroke-width="1.5" opacity=".4"/>`;
svg+=`<path d="${sm(stats.cr)}" fill="none" stroke="var(--chartLine)" stroke-width="2.5" stroke-linecap="round"/>`;
for(let d=0;d<days;d++)svg+=`<rect x="${gx(d)-cw/days/2}" y="${p.t}" width="${cw/days}" height="${ch}" fill="transparent" onmouseenter="shTp(event,${d+1},${Math.round(stats.dr[d]*100)},${Math.round(stats.cr[d]*100)},'${k}')" onmouseleave="hdTp()"/>`;
svg+=`</svg>`;el.innerHTML=svg;}
function shTp(e,d,dl,cm,k){const[y,m]=k.split('-').map(Number);const dt=new Date(y,m-1,d);const t=document.getElementById('tp');t.innerHTML=`${MN[m]} ${d} (${DN[dt.getDay()]}) ‚Äî Daily: ${dl}% ¬∑ Cumul: ${cm}%`;t.style.opacity='1';t.style.left=(e.clientX+12)+'px';t.style.top=(e.clientY-30)+'px';}
function hdTp(){document.getElementById('tp').style.opacity='0';}
function exC(k){const md=D[k],[y,m]=k.split('-').map(Number),days=dim(y,m);let csv='Task,'+Array.from({length:days},(_,i)=>`${m}/${i+1}`).join(',')+'\n';md.tasks.forEach((t,ti)=>{csv+=`"${t.name}",`+Array.from({length:days},(_,d)=>{if(!isA(t,d+1))return'N/A';const mk=gMk(k,ti,d+1);return mk?MK[mk].s:'';}).join(',')+'\n';});const blob=new Blob(['\uFEFF'+csv],{type:'text/csv;charset=utf-8;'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=`tasks_${k}.csv`;a.click();}

const pC=document.getElementById('particles'),pX=pC.getContext('2d');let pts=[];
function rC(){pC.width=innerWidth;pC.height=innerHeight;}rC();addEventListener('resize',rC);
function spP(el){const r=el.getBoundingClientRect(),cx=r.left+r.width/2,cy=r.top+r.height/2,dk=document.documentElement.dataset.theme==='dark';for(let i=0;i<12;i++){const a=Math.random()*Math.PI*2,sp=2+Math.random()*3,sz=2+Math.random()*4;pts.push({x:cx,y:cy,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp-1.5,size:sz,life:1,c:dk?'74,222,128':'22,163,74'});}}
function anP(){pX.clearRect(0,0,pC.width,pC.height);pts=pts.filter(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=.09;p.life-=.022;if(p.life<=0)return false;pX.beginPath();pX.arc(p.x,p.y,p.size*p.life,0,Math.PI*2);pX.fillStyle=`rgba(${p.c},${p.life})`;pX.fill();return true;});requestAnimationFrame(anP);}anP();

function rDash(){const el=document.getElementById('dV');let tS=0,tP=0;const all=MS.map(({y,m})=>{const k=K(y,m);iM(k);const s=gS(k);tS+=s.ts;tP+=s.tp;return{k,mo:MN[m],stats:s};});const oP=tP>0?Math.round(Math.min(tS/tP,1)*100):0;const now=new Date(),curK=K(now.getFullYear(),now.getMonth()+1);
let h=`<div class="dh"><div class="ds"><div class="dsv">${tS.toFixed(1).replace(/\.0$/,'')}</div><div class="dsl">Total Score</div></div><div class="ds"><div class="dsv">${tP}</div><div class="dsl">Total Tasks</div></div><div class="ds"><div class="dsv">${oP}%</div><div class="dsl">Overall Rate</div></div><div class="ds"><div class="dsv">${gStr(curK)}</div><div class="dsl">üî• Streak</div></div></div><div class="dg">`;
h+=`<div class="dc"><h3>Monthly Completion Rate</h3>`;all.forEach(({mo,stats})=>{const p=stats.tp>0?Math.round(Math.min(stats.ts/stats.tp,1)*100):0;h+=`<div class="br"><div class="bl">${mo}</div><div class="bt"><div class="bf" style="width:${Math.max(p,.5)}%"><span class="bp">${p>0?p+'%':''}</span></div></div></div>`;});
h+=`</div><div class="dc"><h3>Task Ranking</h3>`;const tt={};MS.forEach(({y,m})=>{const k=K(y,m),md=D[k];if(!md)return;md.tasks.forEach((t,ti)=>{if(!tt[t.name])tt[t.name]={s:0,p:0};const days=dim(y,m);for(let d=1;d<=days;d++){if(isA(t,d)){tt[t.name].p++;tt[t.name].s+=mV(gMk(k,ti,d));}}});});
Object.entries(tt).map(([n,{s,p}])=>({name:n,pct:p>0?Math.round(Math.min(s/p,1)*100):0})).sort((a,b)=>b.pct-a.pct).forEach((r,i)=>{h+=`<div class="rr"><div class="rn">${i+1}</div><div class="rname">${esc(r.name)}</div><div class="rm"><div class="rmf" style="width:${r.pct}%"></div></div><div class="rp">${r.pct}%</div></div>`;});
h+=`</div><div class="dc full"><h3>Activity Heatmap</h3>`;MS.forEach(({y,m})=>{const k=K(y,m),md=D[k],days=dim(y,m);h+=`<div class="hml">${MN[m]}</div><div class="hmr">`;for(let d=1;d<=days;d++){let act=0,sc=0;if(md){md.tasks.forEach((t,ti)=>{if(isA(t,d)){act++;sc+=mV(gMk(k,ti,d));}});}const p=act>0?Math.min(sc/act,1):0;let l='';if(p>0&&p<=.25)l='l1';else if(p<=.5)l=p>0?'l2':'';else if(p<=.75)l='l3';else if(p>0)l='l4';h+=`<div class="hd ${l}" title="${MN[m]} ${d}: ${Math.round(p*100)}%"></div>`;}h+=`</div>`;});
h+=`</div></div>`;el.innerHTML=h;}

function tTh(){const h=document.documentElement,c=h.dataset.theme,n=c==='dark'?'light':'dark';h.dataset.theme=n;document.getElementById('tb').textContent=n==='dark'?'‚òÄÔ∏è':'üåô';try{localStorage.setItem('th8',n);}catch(e){}if(cv&&cv!=='dashboard')setTimeout(()=>drCh(cv,gS(cv)),50);}
function lTh(){try{const t=localStorage.getItem('th8');if(t){document.documentElement.dataset.theme=t;document.getElementById('tb').textContent=t==='dark'?'‚òÄÔ∏è':'üåô';}}catch(e){}}

load();lTh();const now=new Date();let dk=null;for(const{y,m}of MS)if(now.getFullYear()===y&&now.getMonth()+1===m){dk=K(y,m);break;}
if(!dk)dk=K(2026,3);cv=dk;rNav();sw(cv);
addEventListener('resize',()=>{rC();if(cv&&cv!=='dashboard')drCh(cv,gS(cv));});
</script>
</body>
</html>
